# TCP & UDP

## TCP简介

TCP 提供一种面向连接的、可靠的字节流服务

那么TCP是怎么做到安全可靠的呢？

1.  通过三次握手建立连接
	
	* 客户端->服务端: syn = 1, seq = x
	* 服务端->客户端: syn = 1,seq = y, ack = x + 1
	* 客户端->服务端: ack = y + 1,  ACK = 1,  seq = x

ACK：确认序号有效。（为了与确认号ack区分开，我们用大写表示）
SYN：发起一个新连接。

总的来说是这么一个过程:

下述为各标签的作用，根据标点符号相互的对应。

第一次握手：你能和我建立连接吗，可以接受到我的数据吗。

​ SYN = 1 ，seq = x

第二次握手：可以建立连接，我接受到你的请求了，能接受到我的数据吗，你的数据是这个吗

​ SYN = 1 ，ACK = 1 ，seq = y ，ack = x + 1

第三次握手：我已经收到你的回复，这是我的数据，这是你的数据（用于再次核对）

​ ACK = 1 ，seq = x + 1 ，ack = y + 1

建立连接成功。

###TCP是如何保证可靠传输的（看书与资料）

套接字(Socket)：IP: Port = 192.168.0.1:80

理想的可靠性：

1. 传输信道不产生差错
2. 不管发送方以多快的速度发送数据，接收方总是来得及处理收到数据

#### 可靠传输的工作原理

1. 停止等待协议

	即发送方A发了一个数据包M给到B，B再发送一个确认包返回给A。如果之间出现了发送错误，或者接受延迟等，就需要进行重发。
	
	显著缺点：信道利用率太低。即需要一个包确认无误之后，再进行下一个包的发送
	
2. 连续ARQ协议

	ARQ(Automatic Repeat reQuest)自动重传请求。连续ARQ请求即为滑动窗口协议。比如发送方同时发送五个包给接收方。用一个滑动窗口进行统筹。
	
	滑动窗口即：
	
	A通过三个指针来表示这个窗口(P1, P2, P3)：
	
	P3 - P1 = A的发送窗口
	P2 - P1 = 已发送但是未收到确认的窗口
	P3 - P2 = 允许发送但是还没有发送的窗口
	
	这个窗口通过B发送回的报文的确认号来调节窗口的大小。而B呢，只会把已经收到的最大的序号当作确认号返回给A，因此在这之前的已经全部处理完成了。而比这个序号大的没有按序到达的包，会暂存在B的内存中。
	
3. 拥塞控制的一般原理

	即对资源的需求大于可用资源。而我们能做的就是防止过多的数据，注入到网络中。
	
### TCP的运输连接管理

1. 采用三次握手

	为什么采用三次握手，主要是为了防止已经失效的连接请求报文传送给了B，那么B会返回一个确认的报文给到A，那么如果采用二次握手，A跟B之间就会建立连接。很明显，这样会浪费资源。
	
2. 四次挥手

	1. A发送报文给B说我要关闭连接
	2. B发送确认包给A说我收到了，但是我还没有准备好
	3. B再发送给A说我已经准备好了
	4. A收到后告诉B，我知道你准备好了，关闭吧


	